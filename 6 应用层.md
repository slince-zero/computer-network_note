## 6.1 应用层概述
- 应用层：解决通过应用进程的交互来实现特定网络应用的问题
- 运输层：解决进程之间基于网络的通信问题
- 网络层：解决分组在多个网络上传输（路由）的问题
- 数据链路层：解决分组在一个网络（或一段链路）上传输的问题
- 物理层：解决使用何种信号来传输比特的问题

* 应用层时计算机网络体系结构的**最顶层**，是**设计和建立计算机网络的最终目的**，也是计算机网络中发展最快的部分
	* 早期基于文本的应用（电子邮件、远程登录、文件传输、新闻组）
	* 20世纪90年代将因特网带入千家万户的万维网WWW
	* 当今流行的即时通信、P2P文件共享以及各种音频应用
	* 计算设备的小型化和“无处不在”，宽带住宅接入和无线接入的日益普及和迅速发展，为未来更多的新型应用提供了广阔的舞台
* 本章中，以一些经典的网络应用为例来学习有关网络应用的原理、协议和实现方面的知识
	* 万维网WWW
	* 域名系统DNS
	* 动态主机配置协议DHC
	* 电子邮件
	* 文件传送协议FTP
	* P2P文件共享
	* 多媒体网络应用

## 6.2 客户-服务器方式和对等方式
* 网络应用程序运行在处于网络边缘的不同的端系统上，通过彼此间的通信来共同完成某项任务
* 开发一种新的网络应用首先要考虑的问题就是**网络应用程序在各种端系统的组织方式和它们之间的关系**目前有两种：
	* **客户/服务器**（Client/Server，C/S）方式
	* **对等**（Peer-to-Peer）方式

### 客户/服务器（C/S）方式
* 客户和服务器是指通信中所涉及的两个应用进程
* 客户/服务器方式所描述的是进程之间服务和被服务的关系
* **客户是服务请求方，服务器是服务提供方**
* **服务器总是处于运行状态，并等待客户的服务请求**。服务器有固定的端口号（例如HTTP服务器的默认端口号是80），而运行服务器的主机也具有固定的IP地址
* C/S方式是因特网上传统的、同时也是最成熟的方式，很多我们熟悉的网络应用采用的都是C/S方式。包括万维网WWW、电子邮件、文件传输FTP等
* 基于C/S方式的应用服务通常是**服务集中型**的，即应用服务集中在网络中比客户计算机少得多的服务器计算机上
	* 由于一台服务器计算机要为多个客户机提供服务，在C/S应用中，**常会出现服务器计算机跟不上众多客户机请求的情况**
	* 为此，在C/S应用中，常用**计算机群集**（或服务器场）构建一个强大的**虚拟服务器**

### 对等（P2P）方式
* 在P2P中，**没有固定的服务器请求者和服务器提供者**，分布在网络边缘各端系统中的应用进程是对等的，被称为对等方。对等方相互之间直接通信，每个对等方既是服务的请求者又是服务的提供者
* 目前，在因特网上流行的P2P应用主要包括P2P文件共享、即时通信、P2P流媒体、分布式存储等
* 基于P2P的应用是**服务分散型**的，因为服务不是集中在少数几个服务器计算机中，而是分散在大量对等计算机中，这些计算机并不为服务提供商所有，而是为个人控制的桌面计算机和笔记本电脑，它们通常位于住宅、校园和办公室中
* P2P方式的最突出的特性之一就是它的**可扩展性**。因为系统每增加一个对等方，不仅增加的是服务的请求者，同时也增加了服务的提供者，**系统性能不会因为规模的增大而降低**
* P2P方式**具有成本上的优势**，因为它通常不需要庞大的服务器设施和服务器带宽，为了降低成本，服务提供商对于将P2P方式用于应用的兴趣越来越大

## 6.3 动态主机配置协议DHCP
* 动态主机配置协议DHCP（Dynamic Host Configuration Protocol）提供了一种机制，称为即插即用连网。这种机制**允许一台计算机加入新网络时可自动获取IP地址等网路配置信息而不用手工参与**
* DHCP主要使用以下报文来实现其功能：
	* DHCP DISCOVER：DHCP发现报文
	* DHCP REQUEST：DHCP请求报文
	* DHCP NACK：DHCP否认报文
	* DHCP OFFER：DHCP提供报文
	* DHCP ACK：DHCP确认报文
	* DHCP RELEASE：DECP释放报文

* DHCP报文**在运输层使用UDP协议封装**
	* DHCP客户使用的UDP端口号为68
	* DHCP服务器使用的UDP端口号为67

* DHCP客户在**未获取到IP地址时使用地址0.0.0.0
* 在每一个网络上都设置一个DHCP服务器会使DHCP服务器的数量太多。因此现在是每一个网络至少有一个**DHCP中继代理（通常是一台路由器）**，它配置了DHCP服务器的IP地址信息，作为各网络中计算机与DHCP服务器的桥梁

## 6.4 域名系统DNS（Domain Name System）
* 域名系统DNS是因特网使用的命名系统，用来把便于人们记忆的具有特定含义的主机名（例如www.baidu.com），转换为便于机器处理的IP地址
* 因特网采用**层次树状结构的域名系统**。   ... .三级域名.二级域名.顶级域名
* **顶级域名TLD**（Top Level Domain）分为以下三类：
	* 国家顶级域名nTLD
	* 通用顶级域名gTLD
	* 反向域arpa

* 域名和IP地址的映射关系必须保存在域名服务器中，供所有其他应用查询。显然不能将所有信息都储存在一台域名服务器中，DNS使用**分布在各地的域名服务器**来实现域名到IP地址的转换
* 域名服务器可以划分为以下四种不同的类型：
	* 根域名服务器
	* 顶级域名服务器
	* 权限域名服务器
	* 本地域名服务器
* 域名解析的过程使用两种域名查询方式：
	* **递归查询**
	* **迭代查询**


![](/Users/zhangbowen/Desktop/计算机网络/30.jpeg)

* 为了提高DNS的查询效率，并减轻根域名服务器的负荷和减少因特网上的DNS查询报文数量，在域名服务器和主机中广泛地使用了**高速缓存**
* DNS报文使用运输层的UDP协议进行封装，运输层**端口号为53**


## 6.5 文件传送协议FTP
* 将某台计算机中的文件通过网络传送到可能相距很远的另一台计算机中，是一项基本的网络应用，即文件传送
* **文件传送协议FTP**（File Transport Protocol）是因特网上使用的最广泛的文件传送协议
	* FTP**提供交互式的访问**，允许客户**指明文件的类型与格式**（如是否使用ASCII码），并允许**文件具有存取权限**（如访问文件的用户必须经过授权，并输入有效的口令）
	* **FTP屏蔽了各计算机系统的细节，因而适合于在异构网络中任意计算机之间传送文件**
* 在因特网发展的早期阶段，用FTP传送文件约占整个因特网的通信量的三分之一，而电子邮件和域名系统所产生的通信量还要小于FTP所产生的通信量。只是到了1995年，万维网WWW的通信量才首次超过了FTP
* FTP客户和服务器之间要**建立以下两个并行的TCP连接**
	* **控制连接**：在整个会话期间一直保持打开，用于传送FTP相关控制命令
	* **数据连接**：用于文件传输，在每次文件传输时才建立，传输结束就关闭
	* **默认情况下，FTP使用TCP 21 端口进行控制连接，TCP 20端口进行数据连接**，但是是否使用 TCP 20 端口建立数据连接与传输模式有关，**主动方式使用TCP 20端口，被动方式由服务器和客户端自行协商决定**
![](/Users/zhangbowen/Desktop/计算机网络/31.jpeg)


## 6.6电子邮件
* 电子邮件系统采用**客户/服务器方式**。三个主要构成：**用户代理、邮件服务器**，以及电子邮件所需的**协议**
	* **用户代理**是用户与电子邮件系统的接口，又称为**电子邮件客户端软件**
	* **邮件服务器**是电子邮件系统的基础设施，因特网上所有的ISP都有邮件服务器，其功能是**发送和接收邮件**，同时还要负责维护用户的邮箱
	* **协议**包括邮件**发送协议**（SMTP）和邮件**读取协议**（P0P3）
* 常用的**邮件发送协议**是**简单邮件传输协议SMTP**
	* 基于TCP连接，端口号为25
	* 只能传送ASCII码文本
	* 用于用户代理向邮件服务器发送邮件以及邮件服务器之间的邮件发送
* 为解决SMTP传送非ASCII码文本问题，提出了**多用途因特网邮件扩展MIME**
* 常用的**邮件读取协议**有以下两个：
	* **邮局下一POP3**：非常简单，功能有限的邮件读取协议，用户只能以下载并删除方式或下载并保留方式从邮件服务器下载邮件到用户计机。**不允许用户在邮件服务器上管理自己的软件**
	* **因特网邮件访问协议IMAP**：功能比POP3强大的邮件读取协议。**用户在自己的计算机上就可以操控邮件服务器中的邮箱**，就像在本地操控一样，因此IMAP是一个联机协议
	* POP3和IMAP4都采用**基于TCP连接的客户/服务器方式**。POP3使用端口110，IMAP4使用端口143
* 基于万维网的电子邮件
	* 通过**浏览器**登录（提供用户名和口令）**邮件服务器万维网网站**就可以撰写、收发、阅读和管理电子邮件。这种工作模式与IMAP很像，不同的是用户计算机无需安装专门的用户代理程序，只需要使用通用的万维网浏览器
	* 这种工作模式在**用户浏览器与邮件服务器网站之间使用HTTP协议**，而**邮件服务器之间使用SMTP协议**
	
## 6.7 万维网WWW
* 万维网WWW（World Wide Web）是一个大规模的、联机式的信息储藏所，是运行在因特网上的一个**分布式应用**。
* 浏览器最重要的部分是**渲染引擎**，也就是**浏览器内核**，负责对网页内容进行解析和显示
* 万维网使用**统一资源定位符URL**来指明因特网上任何种类“资源”的位置。其一般形式：<协议>://<主机>:<端口>/<路径>
* 万维网文档：
	* **超文本标记语言HTML**，使用多种“标签”来描述网页的结构和内容
	* **层叠样式表CSS**，从审美角度来描述网页的样式
	* **脚本语言javascript**，控制网页的行为
* **超文本传输协议HHTTP**（HyperText Transfer Protocol）定义了浏览器（即万维网客户进程）怎样向万维网服务器请求万维网文档以及万维网服务器怎样把万维网文档传送给浏览器
	* HTTP/1.0 采用**非持续连续**方式，每次浏览器要请求一个文件都要与服务器建立TCP连接（80）端口，当收到响应后就立即关闭连接
	* HTTP/1.1 采用**持续连接**方式，万维网服务器在发送响应后仍然保持这条连接，使同一个客户（浏览器）和该服务器可以继续在这条连接上传送后续的HTTP请求报文和响应报文。为了进一步提高效率，还可以采用**流水线**方式，即浏览器在收到HTTP的响应报之前就能连续发送多个请求报文
* Http有两类报文：**请求报文**和**响应报文**。报文中的每一个字段都是一些ASCII码串，并且每个字段的长度都是不确定的
* Cookie提供了一种机制使得万维网能够“记住”用户，而无需用户主动提供用户标识信息。也就是说，**Cookie是一种无状态的HTTP进行状态化的技术**
* 在万维网中还可以使用缓存机制以提高万维网的效率。万维网缓存又称为**Web缓存**，可位于客户机，也可位于中间系统上，位于中间系统上的Web缓存又称为**代理服务器**











